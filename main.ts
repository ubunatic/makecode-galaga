namespace SpriteKind {
    export const Wall = SpriteKind.create()
    export const Bomb = SpriteKind.create()
    export const Shield = SpriteKind.create()
}
controller.B.onEvent(ControllerButtonEvent.Pressed, function () {
    if (x_shield_level >= 0) {
        projectile = sprites.createProjectileFromSprite(x_shield_shot, ship, 100, 0)
        projectile.setKind(SpriteKind.Shield)
        music.jumpUp.play()
    }
    spawnShield()
})
sprites.onOverlap(SpriteKind.Enemy, SpriteKind.Wall, function (sprite, otherSprite) {
    destroySprite(sprite)
    addScore(1)
})
function destroySprite (sprite: Sprite) {
    sprite.setVelocity(0, 0)
    sprite.destroy(effects.fire, 100)
    music.baDing.play()
}
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    projectile = sprites.createProjectileFromSprite(img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . 4 4 2 . . . . 
        . . . . . . . 4 2 4 5 4 2 . . . 
        . . . . 4 . 4 5 4 5 6 5 4 2 . . 
        . . 4 . . 4 5 4 5 5 6 6 5 2 . . 
        . . . . 4 . 4 5 4 5 6 5 4 2 . . 
        . . . . . . . 4 2 4 5 4 2 . . . 
        . . . . . . . . . 4 4 2 . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `, ship, 200, 0)
    music.pewPew.play()
})
sprites.onOverlap(SpriteKind.Enemy, SpriteKind.Projectile, function (sprite, otherSprite) {
    destroy(sprite, otherSprite)
    addScore(1)
})
function spawnShield () {
    if (wall) {
        wall.destroy()
    }
    x_shield_level = 0
    x_shield_frame_duration = 1000 / SHIELD_POWER
    wall = sprites.create(img`
        ................................
        ................................
        ................................
        ................................
        ................................
        ................................
        ................................
        ................................
        ................................
        ................................
        ...........................9....
        ...........................69...
        ...........................69...
        ...........................9....
        ................................
        ................................
        ................................
        ................................
        ................................
        ................................
        ................................
        ................................
        ................................
        ................................
        `, SpriteKind.Wall)
    wall.setPosition(ship.x, ship.y)
    wall.follow(ship, 30)
    pause(x_shield_frame_duration)
    wall.setImage(img`
        ................................
        ................................
        ................................
        ................................
        ................................
        ................................
        ................................
        ................................
        ..........................9.....
        ..........................69....
        ...........................69...
        ...........................69...
        ...........................69...
        ...........................69...
        ..........................69....
        ..........................9.....
        ................................
        ................................
        ................................
        ................................
        ................................
        ................................
        ................................
        ................................
        `)
    pause(x_shield_frame_duration)
    wall.setImage(img`
        ................................
        ................................
        ................................
        ................................
        ................................
        .........................99.....
        ..........................69....
        ...........................69...
        ...........................69...
        ...........................69...
        ............................69..
        ............................69..
        ............................69..
        ............................69..
        ...........................69...
        ...........................69...
        ...........................69...
        ..........................69....
        .........................99.....
        ................................
        ................................
        ................................
        ................................
        ................................
        `)
    pause(x_shield_frame_duration)
    wall.setImage(img`
        ................................
        ................................
        ................................
        ................................
        ..........................9.....
        ..........................69....
        ..........................69....
        ...........................69...
        ...........................69...
        ...........................69...
        ............................69..
        ............................69..
        ............................69..
        ............................69..
        ...........................69...
        ...........................69...
        ...........................69...
        ..........................69....
        ..........................69....
        ..........................9.....
        ................................
        ................................
        ................................
        ................................
        `)
    pause(x_shield_frame_duration)
    wall.setImage(img`
        ................................
        ................................
        ................................
        ..........................9.....
        ..........................69....
        ..........................69....
        ...........................69...
        ...........................69...
        ...........................69...
        ............................69..
        ............................69..
        ............................69..
        ............................69..
        ............................69..
        ............................69..
        ...........................69...
        ...........................69...
        ...........................69...
        ..........................69....
        ..........................69....
        ..........................9.....
        ................................
        ................................
        ................................
        `)
    pause(x_shield_frame_duration)
    wall.setImage(img`
        ................................
        ..........................9.....
        ..........................69....
        ..........................69....
        ..........................699...
        ...........................69...
        ...........................69...
        ...........................69...
        ............................69..
        ............................69..
        ............................69..
        ............................69..
        ............................69..
        ............................69..
        ............................69..
        ............................69..
        ...........................69...
        ...........................69...
        ...........................69...
        ..........................699...
        ..........................69....
        ..........................69....
        ..........................9.....
        ................................
        `)
    x_shield_level = 100
}
info.onCountdownEnd(function () {
    SHOOT_DELAY = 100
    SCORE_BONUS = 0
})
sprites.onOverlap(SpriteKind.Enemy, SpriteKind.Player, function (sprite, otherSprite) {
    destroySprite(sprite)
    info.changeLifeBy(-1)
})
sprites.onOverlap(SpriteKind.Enemy, SpriteKind.Shield, function (sprite, otherSprite) {
    destroySprite(sprite)
    addScore(1)
})
function spawn (sprite: Sprite, vx: number) {
    sprite.setVelocity(vx, 0)
    sprite.x = scene.screenWidth()
    sprite.y = randint(0, scene.screenHeight())
    sprite.setFlag(SpriteFlag.AutoDestroy, true)
    return sprite
}
controller.A.onEvent(ControllerButtonEvent.Repeated, function () {
    projectile = sprites.createProjectileFromSprite(img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . 4 4 2 . . . . 
        . . . . . . . 4 2 4 5 4 2 . . . 
        . . . . 4 . 4 5 4 5 6 5 4 2 . . 
        . . 4 . . 4 5 4 5 5 6 6 5 2 . . 
        . . . . 4 . 4 5 4 5 6 5 4 2 . . 
        . . . . . . . 4 2 4 5 4 2 . . . 
        . . . . . . . . . 4 4 2 . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `, ship, 200, 0)
    music.pewPew.play()
    pause(SHOOT_DELAY)
})
sprites.onOverlap(SpriteKind.Player, SpriteKind.Food, function (sprite, otherSprite) {
    otherSprite.destroy()
    info.stopCountdown()
    info.startCountdown(10)
    SHOOT_DELAY = SHOOT_DELAY / 2
    SCORE_BONUS = SCORE_BONUS + 1
    blinkShip(19)
})
function destroy (projectile: Sprite, sprite: Sprite) {
    destroySprite(projectile)
    destroySprite(sprite)
}
sprites.onCreated(SpriteKind.Projectile, function (sprite) {
    sprite.x = sprite.x + 100
})
function blinkShip (times: number) {
    for (let index = 0; index < times; index++) {
        ship.setImage(x_ship_pic_powered)
        pause(250)
        ship.setImage(x_ship_pic)
        pause(250)
    }
}
function addScore (value: number) {
    if (value > 0) {
        info.changeScoreBy(value + SCORE_BONUS)
    }
    if (game.runtime() > 60000) {
        if (info.score() >= 100) {
            game.over(true)
        } else {
            game.over(false)
        }
    }
}
let x_shield_frame_duration = 0
let wall: Sprite = null
let projectile: Sprite = null
let x_shield_level = 0
let ship: Sprite = null
let x_shield_shot: Image = null
let x_ship_pic_powered: Image = null
let x_ship_pic: Image = null
let SCORE_BONUS = 0
let SHOOT_DELAY = 0
let SHIELD_POWER = 0
music.setVolume(50)
SHIELD_POWER = 4
SHOOT_DELAY = 250
SCORE_BONUS = 0
x_ship_pic = img`
    ................................
    ................................
    ................................
    .ccc2...........................
    ..aaac........999...............
    ...ccaccccccb91669..............
    ..5aaccbbbbcccb6669.............
    554ccaccccccbbebec2.............
    ..5aaccbbbbccc2c2c4.............
    ...ccaccccccbbccccc.............
    ..aaac..........................
    .ccc2...........................
    ................................
    ................................
    ................................
    ................................
    `
x_ship_pic_powered = img`
    ................................
    ................................
    ................................
    .ccb5...........................
    ..aabc........999...............
    ...ccaccccccb91669..............
    .55aaccbbbbcccb6669.............
    554ccaccccccbb2b2b4.............
    .55aaccbbbbccc4c4c5.............
    ...ccaccccccbbccccc.............
    ..aabc..........................
    .ccb5...........................
    ................................
    ................................
    ................................
    ................................
    `
x_shield_shot = img`
    ................9.......
    ................69......
    .................69.....
    ..................69....
    ..................69....
    ...................69...
    ...................69...
    ...................69...
    ....................69..
    ....................69..
    ....................69..
    ....................69..
    ....................69..
    ....................69..
    ....................69..
    ....................69..
    ...................69...
    ...................69...
    ...................69...
    ..................69....
    ..................69....
    .................69.....
    ................69......
    ................9.......
    `
ship = sprites.create(x_ship_pic, SpriteKind.Player)
ship.setPosition(10, 50)
info.setLife(3)
controller.moveSprite(ship, 200, 200)
ship.setFlag(SpriteFlag.StayInScreen, true)
spawnShield()
game.splash("Hit 100 enemies", "in 60 seconds!")
game.onUpdateInterval(5000, function () {
    spawn(sprites.create(img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . b b b b . . . . . . 
        . . . . . b a a a a b . . . . . 
        . . . . c a a 5 5 a a b . . . . 
        . . . . c a 5 a a 5 a b . . . . 
        . . . . c a 5 a a a a b . . . . 
        . . . . c a a 5 5 a a b . . . . 
        . . . . c a a a a 5 a b . . . . 
        . . . . c a 5 a a 5 a b . . . . 
        . . . . c a a 5 5 a a b . . . . 
        . . . . . c a a a a b . . . . . 
        . . . . . . c c c c . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `, SpriteKind.Food), -150)
})
game.onUpdateInterval(1000, function () {
    // trigger score check
    addScore(0)
})
game.onUpdateInterval(500, function () {
    spawn(sprites.create(img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . f 6 6 6 6 6 6 7 7 . . . 
        . . . f 6 7 7 7 . . . . . . . . 
        . . . 7 6 6 6 6 6 6 6 6 6 7 7 . 
        . . . 7 6 9 9 9 6 7 7 . . . . . 
        . . . 7 6 9 9 9 6 7 7 . . . . . 
        . . . 7 6 6 6 6 6 6 6 6 6 7 7 . 
        . . . f 6 7 7 7 . . . . . . . . 
        . . . . f 6 6 6 6 6 6 7 7 . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `, SpriteKind.Enemy), -100)
})
